# Java LLM Spec Research

本リポジトリは、仕様書の曖昧性とLLMコード生成の手戻り要因を調査する実験ログを蓄積する場所である。直近の調査は `research20250917/` にまとまり、仕様進化(R→Q→D)の運用ガードレールを策定したところで不確定要素が残ったまま終了した。

## 現状サマリ
- 仕様の曖昧さを意図的に含んだ図書貸出システムで7日間の検証を実施。
- JUnitによる赤テスト資産を構築し、LLM生成コードを段階的に修正して全テストを緑化。
- 途中、人気本の貸出期間が想定より短く実装される等、LLMが仕様外の値を埋め込むリスクを観測。
- 研究最終日に振り返りを行い、ブレ・質問過多・テスト扱いの難しさを主な課題として整理。

## 未解消の不確定要素
- 次フェーズで導入予定だった仕様v3の要件が未着手で、RQDサイクルの改善効果は未検証。
- 日次プロンプトで定義したガードレール（`research20250917/README.md` の貼り付け用プロンプト）が実際に機能するかは検証待ち。
- LLMが過剰実装を行う条件や抑制方法は仮説段階に留まっている。


## ディレクトリ
- `research20250917/` — 2025-09-17開始の調査セット。進捗ログとガードレール付きプロンプトを含む。

## 実験ごとの仮説

### Day1〜Day7（research20250917）
- 仕様書に曖昧さを残したままLLMに渡すと、**質問数が爆発**し収束できなくなる。
- LLMは「継続可能」と安易に提案し、**本来終了すべき場面でも続行してしまう**。
- 仕様外の値を勝手に埋め込む傾向があり、**過剰実装リスク**が存在する。
- テストケースを仕様サイクルと混在させると、**教師データと検証対象が衝突**し、研究の透明性が下がる。

### Day8（root直下で再スタート）
- **失敗判定ルール v1** を導入すれば、成り行き継続を防ぎ、**客観的に終了条件を満たした時点で止められる**。
- メトリクス（質問数、曖昧性残数、スコープ逸脱率）を計測すれば、**失敗の構造をデータとして可視化**できる。
- 本フェーズの目的は成功よりも「**なぜうまくいかないのか**」を特定すること。

## 今回の結論（終了）

- 指導用LLMが役割を越え、仕様本文や差分生成まで行ってしまった。  
- その結果、日本語が不自然になり、不要な構造化が混入し、期待からずれた。  
- 教訓：役割を固定する。  
  - 指導用LLM＝計画・進行・ゲートのみ。仕様本文やdiffの生成はしない。  
  - 実験対象LLM＝質問→回答→diff提案を出す。PoRは凍結前提。  
  - draftは人間が読める「変更一覧」に一本化（Before/After、または「見出しの末尾に追加」等で位置を明記）。  
  - 言い回しは短文・言い切り。用語は「貸出／返却／保有／上限／期限超過」に固定。曖昧語は使わない。  
- 次の実験では上記を初期プロンプトに含める。越境が発生した時点で失敗として打ち切る。

本実験は Day8 時点で終了。

## 次の実験に向けて
- 新しい調査を始める際は、本READMEを維持しつつ専用ディレクトリを追加し、`research20250917/README.md:88` 以降のガードレールを初期プロンプトとして適用する。
- 仕様v3の要求定義とRQDサイクル再検証から着手し、曖昧性解消とテスト導線の効果測定を継続する。

今後も各実験ごとにサブディレクトリを作成し、このルートREADMEに概要と状況を追記していくことを推奨する。
